<html>
  <head>
    <link rel="stylesheet" href="styles.css">
  </head>

  <body>
    <div class="input-container">
      <input
        id="input_vid"
        type="text"
        placeholder="Video ID or URL"
        onclick="select_input_vid()"
        onkeypress="if(event.key === 'Enter') apply_input_vid_from_button()"
      />
      <button
        id="apply-vid-btn"
        onclick="apply_input_vid_from_button()"
        style="
          height: 50px;
          padding: 0 20px;
          font-size: 14px;
          background-color: #2d6a4f;
          color: #ffffff;
          border: none;
          cursor: pointer;
          border-radius: 4px;
          font-weight: bold;
          transition: background 0.2s;
        "
        onmouseover="this.style.background='#40916c';"
        onmouseout="this.style.background='#2d6a4f';"
      >Go</button>
    </div>

    <div id="parsed-url-container" style="display: none; margin: 15px 0;">
      <div style="display: flex; justify-content: center;">
        <input
          id="parsed-url"
          type="text"
          readonly
          style="
            width: 60%;
            max-width: 600px;
            padding: 8px 12px;
            background-color: #1a1a1a;
            color: #6cf06c;
            border: 1px solid #333;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
            text-align: center;
            cursor: pointer;
          "
          onclick="this.select(); document.execCommand('copy');"
          title="Click to copy"
        />
      </div>
    </div>

    <div id="ytplayer"></div>
    <div id="timeline-time" style="text-align:center; color:#ccc; font-size:0.95rem; margin-bottom:2px; display:flex; justify-content:center; align-items:center; gap:8px;">
      <button id="timeline-cancel-btn" title="Cancel seek" style="margin-right:8px; font-size:1.1em; display:none;">‚ùå</button>
      <span id="timeline-time-span"></span>
      <span id="timeline-drag-span" style="color:#6cf06c; display:none; margin-left:8px;"></span>
      <button id="timeline-apply-btn" title="Seek to this time" style="margin-left:8px; font-size:1.1em; display:none;">‚úÖ</button>
    </div>
    <input
      id="timeline"
      type="range"
      min="0"
      max="100"
      value="0"
      step="1"
      style="width: 100%; margin: 10px 0;"
    />

    <div style="display: flex; justify-content: center; margin: 10px 0;">
      <button
        id="play-pause-btn"
        style="
          background: #232323;
          color: #6cf06c;
          border: 1px solid #333;
          border-radius: 8px;
          font-size: 1.3rem;
          font-weight: bold;
          padding: 12px 28px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.12);
          cursor: pointer;
          transition: background 0.2s, color 0.2s;
          margin-right: 10px;
        "
        onmouseover="this.style.background='#1a1a1a';this.style.color='#fff';"
        onmouseout="this.style.background='#232323';this.style.color='#6cf06c';"
      >Play/Pause</button>
      <button
        id="switch-width-btn"
        style="
          background: #232323;
          color: #8ecae6;
          border: 1px solid #333;
          border-radius: 8px;
          font-size: 1.3rem;
          font-weight: bold;
          padding: 12px 28px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.12);
          cursor: pointer;
          transition: background 0.2s, color 0.2s;
        "
        onmouseover="this.style.background='#1a1a1a';this.style.color='#fff';"
        onmouseout="this.style.background='#232323';this.style.color='#8ecae6';"
      >Viewport</button>
    </div>

    <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
      <div style="flex: 1; min-width: 300px; max-width: 600px;">
        <h3 style="text-align: center; color: #8ecae6; margin-bottom: 10px;">History</h3>
        <ul id="history_list"></ul>
        <input
          type="button"
          id="clear-history-btn"
          value="Clear History"
          onclick="clearHistory()"
          style="
            display: block;
            margin: 18px auto 10px auto;
            width: 100%;
            max-width: 480px;
            background: #232323;
            color: #ff6b6b;
            border: 1px solid #333;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
          "
          onmouseover="this.style.background='#3a2323';this.style.color='#fff';"
          onmouseout="this.style.background='#232323';this.style.color='#ff6b6b';"
        />
        <input
          type="button"
          id="dump-events-btn"
          value="üêõ Debug: Dump All Events"
          onclick="dumpAllEvents()"
          style="
            display: block;
            margin: 10px auto;
            width: 100%;
            max-width: 480px;
            background: #232323;
            color: #8ecae6;
            border: 1px solid #333;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
          "
          onmouseover="this.style.background='#1a3a3a';this.style.color='#fff';"
          onmouseout="this.style.background='#232323';this.style.color='#8ecae6';"
        />
      </div>
      <div style="flex: 1; min-width: 300px; max-width: 600px;">
        <h3 style="text-align: center; color: #ffd166; margin-bottom: 10px;">Watch Later</h3>
        <div id="watch-later-status" style="text-align: center; color: #bbb; font-size: 0.9rem; padding: 20px;">
          Sign in to sync watch later list
        </div>
        <ul id="watch_later_list"></ul>
        <input
          type="button"
          id="refresh-watch-later-btn"
          value="Refresh Watch Later"
          onclick="loadWatchLater()"
          style="
            display: block;
            margin: 18px auto 10px auto;
            width: 100%;
            max-width: 480px;
            background: #232323;
            color: #ffd166;
            border: 1px solid #333;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
          "
          onmouseover="this.style.background='#3a3323';this.style.color='#fff';"
          onmouseout="this.style.background='#232323';this.style.color='#ffd166';"
        />
      </div>
    </div>
    <div id="msal-login-container" style="position: fixed; bottom: 16px; right: 16px; display: flex; flex-direction: column; align-items: flex-end; gap: 6px; z-index: 9999; max-width: 300px;">
      <div id="msal-user-info" style="display: none; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; padding: 10px 12px; margin-bottom: 4px; text-align: right;">
        <div id="msal-user-name" style="color: #8ecae6; font-size: 0.95rem; font-weight: 600; margin-bottom: 2px;"></div>
        <div id="msal-user-email" style="color: #bbb; font-size: 0.8rem; word-break: break-all;"></div>
      </div>
      <div id="msal-error" style="display: none; background: #3a1a1a; border: 1px solid #ff6b6b; border-radius: 8px; padding: 10px 12px; margin-bottom: 4px; text-align: right; max-width: 300px;">
        <div style="color: #ff6b6b; font-size: 0.85rem; font-weight: 600; margin-bottom: 4px;">Login Error</div>
        <div id="msal-error-message" style="color: #ffaaaa; font-size: 0.75rem; word-break: break-word;"></div>
      </div>
      <label style="display: flex; align-items: center; gap: 6px; font-size: 0.85rem; color: #bbb; cursor: pointer;">
        <input type="checkbox" id="msal-force-mobile" style="cursor: pointer;">
        <span>Use mobile login flow</span>
      </label>
      <label style="display: flex; align-items: center; gap: 6px; font-size: 0.85rem; color: #bbb; cursor: pointer;">
        <input type="checkbox" id="history-sync-enabled" style="cursor: pointer;">
        <span>Sync history to TODO</span>
      </label>
      <button id="msal-login-btn" style="background: #232323; color: #8ecae6; border: 1px solid #333; border-radius: 8px; font-size: 0.95rem; font-weight: 600; padding: 8px 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.12); cursor: pointer; transition: background 0.2s, color 0.2s;">Microsoft Sign in</button>
      <span id="msal-login-status" style="color: #bbb; font-size: 0.85rem;">Signed out</span>
    </div>
    <div id="version-info" style="position: fixed; bottom: 16px; left: 16px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; padding: 8px 12px; z-index: 9999;">
      <div style="color: #666; font-size: 0.75rem; font-family: monospace;">
        <span style="color: #888;">v:</span> <span id="commit-hash">dev</span>
      </div>
    </div>

    <!-- MSAL Library -->
    <script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>

    <!-- Main Application (ES6 Module) -->
    <script type="module" src="js/main.js"></script>
  </body>
</html>
